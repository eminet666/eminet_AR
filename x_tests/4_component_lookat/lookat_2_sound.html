<!-- https://stackoverflow.com/questions/47921013/play-sound-on-click-in-a-frame -->
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://rawgit.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="../js/unlock_audio_ios.js"></script>

    <style>
        #musique {
            position: absolute; left: 10px; bottom: 10px; width: 800px; height: 30px;
            display: flex; flex-direction: row; align-items: center; justify-content: flex-start;
            border: dotted black 1px;
        }
        #contexte { height: 30px;}
        #idBouton { height: 30px;}
        p { font-size : 0.8em; font-family: Arial, Helvetica, sans-serif; margin-left: 20px; }
    </style>

    <script>
        var dim = 5;
        var interval = 3000;

        AFRAME.registerComponent('addnew', {
          tick: function (t) {
            var entity = this.el;

            // Run on an interval.
            if (t - this.time < interval) { return; }
            this.time = t;
            // console.log(t);
            addOne();
          }
        });

        // AFRAME.registerComponent('remove', {
        //     init: function() {
        //         this.el.addEventListener('click', e => {
        //             // removeOne(this.el);
        //             addOne();
        //         })
        //     }
        // })

        function addOne() {
            let scene = document.getElementById("scene");
            let pool = scene.components["pool__monkeys"];
            let instance = pool.requestEntity();
            let x = getNum(-dim, dim);
            let y = getNum(0, dim);
            let z = getNum(-dim, dim);
            let pos = x+" "+y+" "+z;
            console.log(pos);
            instance.setAttribute('position', pos);
            instance.play();
            let son = document.getElementById("son");
            console.log(son);
            son.setAttribute('position', pos);
            // console.log(son);
            son.play;
        }
        function removeOne(el) {
            let scene = document.getElementById("scene");
            let pool = scene.components["pool__suzanne"];
            pool.returnEntity(el);
        }

        function getNum(min, max) {
          return (Math.floor(Math.random() * (max - min + 1) ) + min).toFixed(1);
        }

    </script>
</head>

<body>
        <a-scene id="scene" background="color: #5280A7"
                 pool__monkeys="mixin: suzanne; size: 100; dynamic: true"
                 cursor='rayOrigin: mouse'
                 addnew>

            <a-camera position="0 1.6 4" look-controls wasd-controls>
                <a-cursor position="0 0 -3"
                          geometry="primitive: ring; radiusInner: 0.05; radiusOuter: 0.08;"
                          material="color: blue; shader: flat"
                          fuse= "true"
                          <a-animation begin="fusing" easing="ease-in" attribute="scale"
                                 fill="backwards" from="1 1 1" to="0.2 0.2 0.2" dur="1500">
                          </a-animation>
                </a-cursor>
            </a-camera>
            <!-- <a-entity id="player" look-controls wasd-controls position="0 1.7 0"></a-entity> -->

            <a-assets>
                <a-asset-item id="glbModel" src="../assets/3Dmodels/suzanne.glb"></a-asset-item>
                <audio id="boing" src="./boing.mp3" preload="auto" crossorigin="anonymous"></audio>
                <a-mixin id="suzanne" gltf-model="#glbModel" look-at="[camera]"
                         scale="0.5 0.5 0.5" remove>
                </a-mixin>
            </a-assets>

            <a-sound id="son" src="#boing" autoplay="false" loop="false" volume="1"
                     sound="maxDistance:20;rolloffFactor:10" position="0 0 0">
            </a-sound>

            <a-plane position="0 0 0" rotation="-90 0 0" width="15" height="15" color="#CCCCCC"
                     shadow="receive: true" shadow-material="opacite: 0.5">
            </a-plane>
            <a-plane position="0 0 0" rotation="-90 0 0" width="15" height="15" color="#CCCCCC">
            </a-plane>

            <div id="musique">
              <button id="bouton">SON ON</button>
              <p id="info"></p>
              <p id="current"></p>
              <p id="pas"></p>
            </div>

		<script src="./interface.js"></script>

        </a-scene>

    <body>
